#!/usr/bin/bash

if [ "$#" -ne 1 ]; then
    echo "Usage: set-dpi dpi"
    exit -1
fi

dpi=$1
re='^[0-9]+$'
if ! [[ $dpi =~ $re ]] ; then
   echo "Error: DPI is not a number" >&2; exit 1
fi

scale=$(bc <<< "scale=2;$dpi/96.0")
gdk_scale=$(bc <<< "scale=2;$scale/1.14")
echo "Scale: $scale (compared to 96 DPI)"

# General stuff
if grep -q "xrandr --dpi" ~/.xprofile; then
    sed -i".sed" "s/\(xrandr --dpi \)[0-9]\+/\1$dpi/" ~/.xprofile
else
    echo "xrandr --dpi $dpi" >> ~/.xprofile
fi
if grep -q "Xft\.dpi:" ~/.Xresources; then
    sed -i".sed" "s/\(Xft\.dpi: \)[0-9]\+/\1$dpi/" ~/.Xresources
else
    echo "Xft.dpi: $dpi" >> ~/.Xresources
fi

# Awesome WM
for theme in $(find ~/.config/awesome/themes/ -name theme.lua); do
    sed -i".sed" "s/\(local dpi = \)[0-9]\+/\1$dpi/" $theme
done
