#!/usr/bin/env bash

if [ $# -lt 2 ]; then
    echo "Usage: docsync pull|push dir"
    exit -1
fi

direction=$1
directory=$2

remote=tau

while [[ $# -gt 0 ]]; do
    case $1 in
        -h|--help)
            echo "No help yet :("
            exit 0
            ;;
        --home)
            remote="tau-at-home"
            ;;
    esac
    shift
done

flags="-aHAXi --no-xattrs --no-perms --ignore-existing --delete"

case $direction in
    push)
        cmd="rsync ${flags} --exclude .DS_Store ${HOME}/${directory} ${remote}:"
        ;;
    pull)
        cmd="rsync ${flags} ${remote}:${directory} ${HOME}"
        ;;
    *)
        echo "Unknown direction: ${direction}"
        exit -1
        ;;
esac

echo $cmd
$cmd --dry-run
read -p "Execute? [yes/NO]" b
if [ "$b" == "yes" ]; then
    echo "Executing"
    $cmd
else
    echo "Aborting"
fi
